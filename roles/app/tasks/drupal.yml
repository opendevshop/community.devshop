---
- name: "Welcome to the DevShop.App role: Drupal."
  debug:
    msg: |
      inventory_hostname: {{ inventory_hostname }}"

# @TODO: This runs BEFORE git clone, so files won't exist the first time, which should result in devshop_app_installed = false.
- name: Check if site is already installed.
  command: "{{ drush_path }} --root={{ drupal_core_path }} status bootstrap"
  args:
    chdir: "{{ drupal_core_path }}"
  register: drupal_site_installed_register
  failed_when: "drupal_site_installed_register.stdout is undefined"
  changed_when: false
  become: false

- set_fact:
    devshop_app_installed: "{{ 'Drupal bootstrap' in drupal_site_installed.stdout | default(false) }}"

- name: Add install to skipped_stages unless force_install is set.
  set_fact:
    skip_stages: "{{ skip_stages + ['install']}}"
  when:
    - devshop_app_installed
    - force_install is not defined or force_install == false