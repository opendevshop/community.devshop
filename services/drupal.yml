---
apps:
  vars:

    # Needs to be here for service_vars to look it up.
    devshop_app_service_requirements:
      http:
        required: yes
      db:
        required: yes
      solr:
      redis:
      varnish:

  children:
    drupal:
      vars:
        devshop_app_type: drupal

        drupal_install_profile: standard
        drupal_composer_bin_dir: vendor/bin
        drupal_site_install_extra_args: []

        devshop_app_command_build: |
          COMPOSER_MEMORY_LIMIT=-1 composer install

        devshop_app_command_install: >
          drush site-install {{ drupal_install_profile | default('standard') }} -y
          --root={{ devshop_app_git_document_root_path }}
          --db-url={{ devshop_service_db_backend | default('mysql') }}://{{ devshop_service_db_user | default('drupal') }}:{{ devshop_service_db_password | default('drupal') }}@{{ devshop_service_db_host | default('localhost') }}/{{ devshop_service_db_name | default('drupal') }}
          {{ drupal_site_install_extra_args | join(" ") }}

        # The new "drush deploy" command includes all of these steps.
        devshop_app_command_deploy: |
          drush updatedb --no-cache-clear -y
          drush cache:rebuild
          drush config:import --preview -y
          drush cache:rebuild
          drush deploy:hook

        devshop_app_command_test: |
          drush status
          drush uli
