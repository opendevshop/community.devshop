---
servers:
  children:
    http:
      vars:
        devshop_service_http:
          name: Web Service for Drupal
          roles:
            - geerlingguy.apache
            - geerlingguy.certbot
            - geerlingguy.php
            - geerlingguy.php-mysql
            - geerlingguy.php-versions
            - geerlingguy.composer
            - geerlingguy.drush
            - geerlingguy.repo-dotdeb
            - geerlingguy.repo-remi
            - geerlingguy.repo-epel

        # When server is in docker mode, publish HTTP ports
        # @TODO: Switch to "80" etc when proxy container works.
        devshop_host_docker_published_ports:
          - "80:80"
          - "443:443"

        apache_remove_default_vhost: true

apps:
  vars:

    #TODO: Move to default vars.
    # Because this is inventory, we can't use these vars in the next vars.
    devshop_app_http_certificates_root: "{{ devshop_host_apps_root }}/certificates"

    # certbot/letsencrypt
    devshop_app_http_certificate_file: "/etc/letsencrypt/live/{{ inventory_hostname }}/fullchain.pem"
    devshop_app_http_certificate_chain_file: "/etc/letsencrypt/live/{{ inventory_hostname }}/fullchain.pem"
    devshop_app_http_certificate_key_file: "/etc/letsencrypt/live/{{ inventory_hostname }}/privkey.pem"

    devshop_app_http_certificate_common_name: "{{ inventory_hostname }}"
    devshop_app_http_certificate_generate_command: "openssl req -batch -x509 -nodes -days 365 -newkey rsa:2048 -keyout {{ devshop_host_apps_root }}/certificates/{{ inventory_hostname }}.key -out {{ devshop_host_apps_root }}/certificates/{{ inventory_hostname }}.crt -subj '/O={{ inventory_hostname }}/OU={{ inventory_hostname }}/CN={{ inventory_hostname }}/'"

    # Set to false to block creation of a SSL cert.
    devshop_app_server_http_letsencrypt: yes